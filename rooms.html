<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุงููุงุนุงุช</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Arabic+Poetry:opsz,wght@16..72,400;16..72,700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<nav class="navbar">
	<div class="corner-logos">
		<img class="logo-ministry" src="https://i.ibb.co/HfwV7QB5/ministerylogo1-1.png" alt="ุดุนุงุฑ ูุฒุงุฑุฉ ุงูุชุฑุจูุฉ ูุงูุชุนููู ุณูุทูุฉ ุนูุงู">
	</div>
</nav>

<main class="container">
			<div class="site-title-bar" style="text-align:center; margin: 40px auto 0 auto;">
				<span class="site-title">ุฒุงููุฉ</span>
					<div style="position:relative;">
												<button id="menu-toggle" style="display:none; background:none; border:none; position:absolute; left:18px; top:18px; z-index:1100; cursor:pointer;">
													  <span style="font-size:1.5em; color:#1b3767;">&#9776;</span>
												</button>
												<ul class="nav-links" id="nav-links" style="display:flex; justify-content:center; gap:32px; list-style:none; margin:28px auto 0 auto; padding:0; background:rgba(27,55,103,0.12); border-radius:16px; box-shadow:0 2px 12px rgba(27,55,103,0.08);">
													<li><a href="index.html" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">ุงูุฑุฆูุณูุฉ</a></li>
													<li><a href="reservations.html" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">ุงูุญุฌูุฒุงุช</a></li>
													<li><a href="rooms.html" class="active" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">ุงููุงุนุงุช</a></li>
												</ul>
					</div>
			</div>

<main class="container">
	<h1 class="main-title">ุฒุงููุฉ</h1>
<h2>ุฅุฏุงุฑุฉ ุงููุงุนุงุช</h2>

<form id="room-form">
<input type="text" id="room-name" placeholder="ุงุณู ุงููุงุนุฉ" required>
<button type="submit">โ ุฅุถุงูุฉ ูุงุนุฉ</button>
<button type="button" onclick="restoreRoomsBackup()" style="background: #ffc107; color: #212529; margin-right: 10px;">๐ ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ</button>
<button type="button" onclick="resetToDefault()" style="background: #6c757d; color: white; margin-right: 10px;">โ๏ธ ุฅุนุงุฏุฉ ุชุนููู</button>
</form>

<ul id="room-list"></ul>

<!-- ูุงูุฐุฉ ุฅุญุตุงุฆูุงุช ุงููุงุนุฉ -->
<div id="room-stats-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3 id="room-stats-title" style="color: #1b3767; margin: 0;">๐ ุฅุญุตุงุฆูุงุช ุงููุงุนุฉ</h3>
      <button onclick="closeRoomStatsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">ร</button>
    </div>
    
    <div id="room-stats-content" style="text-align: center;">
      <div style="margin: 20px 0;">
        <div style="color: #666;">ุฌุงุฑู ุชุญููู ุงูุฅุญุตุงุฆูุงุช...</div>
      </div>
    </div>
    
    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
      <button onclick="printRoomStats()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
        ๐จ๏ธ ุทุจุงุนุฉ
      </button>
      <button onclick="exportRoomStats()" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">
        ๐พ ุชุตุฏูุฑ
      </button>
    </div>
  </div>
</div>
</main>

<script src="script.js"></script>
<script>
// ูุธุงู ุฅุฏุงุฑุฉ ุงููุงุนุงุช ูุญููุงู
let rooms = [];

// ุชุญููู ุงููุงุนุงุช ูู localStorage
function loadRooms() {
  try {
    const savedRooms = localStorage.getItem('school_rooms');
    if (savedRooms) {
      rooms = JSON.parse(savedRooms);
      console.log('ุชู ุชุญููู ุงููุงุนุงุช ูู localStorage:', rooms);
    } else {
      console.log('ูุง ุชูุฌุฏ ูุงุนุงุช ูุญููุธุฉุ ุฅูุดุงุก ูุงุนุงุช ุงูุชุฑุงุถูุฉ...');
      // ูุงุนุงุช ุงูุชุฑุงุถูุฉ
      rooms = ['ุงููุฎุชุจุฑ', 'ูุงุนุฉ ุงูุญุงุณูุจ', 'ุงูููุชุจุฉ', 'ุงููุงุนุฉ ุงูุฑุฆูุณูุฉ', 'ุงููุงุนุฉ ุงูุฐููุฉ', 'ุบุฑูุฉ ุตููุฉ'];
      saveRooms();
    }
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุชุญููู ุงููุงุนุงุช:', error);
    // ูู ุญุงูุฉ ุงูุฎุทุฃุ ุงุณุชุฎุฏู ุงููุงุนุงุช ุงูุงูุชุฑุงุถูุฉ
    rooms = ['ุงููุฎุชุจุฑ', 'ูุงุนุฉ ุงูุญุงุณูุจ', 'ุงูููุชุจุฉ', 'ุงููุงุนุฉ ุงูุฑุฆูุณูุฉ', 'ุงููุงุนุฉ ุงูุฐููุฉ', 'ุบุฑูุฉ ุตููุฉ'];
    saveRooms();
  }
  
  // ุงูุชุฃูุฏ ูู ูุฌูุฏ ูุงุนุงุช
  if (!Array.isArray(rooms) || rooms.length === 0) {
    console.log('ุชุตุญูุญ: ุฅุถุงูุฉ ูุงุนุงุช ุงูุชุฑุงุถูุฉ');
    rooms = ['ุงููุฎุชุจุฑ', 'ูุงุนุฉ ุงูุญุงุณูุจ', 'ุงูููุชุจุฉ', 'ุงููุงุนุฉ ุงูุฑุฆูุณูุฉ', 'ุงููุงุนุฉ ุงูุฐููุฉ', 'ุบุฑูุฉ ุตููุฉ'];
    saveRooms();
  }
  
  displayRooms();
}

// ุญูุธ ุงููุงุนุงุช ูู localStorage
function saveRooms() {
  try {
    // ุญูุธ ุงููุณุฎุฉ ุงูุฃุณุงุณูุฉ
    localStorage.setItem('school_rooms', JSON.stringify(rooms));
    // ุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ
    localStorage.setItem('school_rooms_backup', JSON.stringify(rooms));
    // ุญูุธ ููุช ุขุฎุฑ ุชุญุฏูุซ
    localStorage.setItem('school_rooms_last_update', new Date().toISOString());
    console.log('ุชู ุญูุธ ุงููุงุนุงุช:', rooms);
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุญูุธ ุงููุงุนุงุช:', error);
    alert('โ๏ธ ุญุฏุซ ุฎุทุฃ ูู ุญูุธ ุงูุจูุงูุงุช. ุชุฃูุฏ ูู ูุฌูุฏ ูุณุงุญุฉ ูุงููุฉ ูู ุงููุชุตูุญ.');
  }
}

// ุนุฑุถ ูุงุฆูุฉ ุงููุงุนุงุช
function displayRooms() {
  const roomList = document.getElementById('room-list');
  roomList.innerHTML = '';
  
  if (rooms.length === 0) {
    roomList.innerHTML = '<li style="text-align: center; color: #666; padding: 20px; font-style: italic;">ูุง ุชูุฌุฏ ูุงุนุงุช ูุถุงูุฉ</li>';
    return;
  }
  
  rooms.forEach((room, index) => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
        <div>
          <strong style="color: #1b3767; font-size: 1.1em;">${index + 1}. ${room}</strong>
          <div style="color: #666; font-size: 0.9em; margin-top: 5px;">๐ ูุงุนุฉ ูุชุงุญุฉ ููุญุฌุฒ</div>
        </div>
        <div style="display: flex; gap: 8px;">
          <button onclick="showRoomStats('${room}')" 
                  style="background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; transition: transform 0.2s;">
            ๐ ุฅุญุตุงุฆูุงุช
          </button>
          <button onclick="deleteRoom(${index})" 
                  style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
            ๐๏ธ ุญุฐู
          </button>
        </div>
      </div>
    `;
    roomList.appendChild(li);
  });
  
  // ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช
  const statsDiv = document.createElement('div');
  statsDiv.style.cssText = `
    background: #1b3767; color: white; padding: 15px; border-radius: 8px; 
    margin: 20px 0; text-align: center;
  `;
  statsDiv.innerHTML = `
    <h3 style="margin: 0 0 15px 0;">๐ ุฅุญุตุงุฆูุงุช ุงููุงุนุงุช</h3>
    <p style="margin: 5px 0; font-size: 1.1em;">
      ุฅุฌูุงูู ุงููุงุนุงุช: <strong>${rooms.length}</strong>
    </p>
    <button onclick="showDataStatus()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin-top: 10px; font-size: 0.9em;">
      ๐ ุญุงูุฉ ุงูุจูุงูุงุช
    </button>
  `;
  roomList.appendChild(statsDiv);
}

// ุฅุถุงูุฉ ูุงุนุฉ ุฌุฏูุฏุฉ
function addRoom(event) {
  event.preventDefault();
  const roomNameInput = document.getElementById('room-name');
  const roomName = roomNameInput.value.trim();
  
  if (!roomName) {
    alert('โ๏ธ ูุฑุฌู ุฅุฏุฎุงู ุงุณู ุงููุงุนุฉ');
    return;
  }
  
  if (rooms.includes(roomName)) {
    alert('โ ูุฐู ุงููุงุนุฉ ููุฌูุฏุฉ ุจุงููุนู');
    return;
  }
  
  rooms.push(roomName);
  saveRooms();
  displayRooms();
  roomNameInput.value = '';
  
  alert(`โ ุชู ุฅุถุงูุฉ ุงููุงุนุฉ "${roomName}" ุจูุฌุงุญ`);
}

// ุญุฐู ูุงุนุฉ
function deleteRoom(index) {
  const roomName = rooms[index];
  if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงููุงุนุฉ "${roomName}"ุ`)) {
    rooms.splice(index, 1);
    saveRooms();
    displayRooms();
    alert(`โ ุชู ุญุฐู ุงููุงุนุฉ "${roomName}" ุจูุฌุงุญ`);
  }
}

// ุชููุฆุฉ ุงููุธุงู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
document.addEventListener('DOMContentLoaded', function() {
  loadRooms();
  document.getElementById('room-form').addEventListener('submit', addRoom);
});

// ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ
function restoreRoomsBackup() {
  try {
    const backupRooms = localStorage.getItem('school_rooms_backup');
    if (backupRooms) {
      const parsedBackup = JSON.parse(backupRooms);
      if (Array.isArray(parsedBackup) && parsedBackup.length > 0) {
        rooms = parsedBackup;
        saveRooms();
        displayRooms();
        alert(`โ ุชู ุงุณุชุนุงุฏุฉ ${rooms.length} ูุงุนุฉ ูู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ`);
      } else {
        alert('โ๏ธ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ูุงุฑุบุฉ ุฃู ุชุงููุฉ');
      }
    } else {
      alert('โ ูุง ุชูุฌุฏ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุชุงุญุฉ');
    }
  } catch (error) {
    console.error('ุฎุทุฃ ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ:', error);
    alert('โ ูุดู ูู ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ');
  }
}

// ุฅุนุงุฏุฉ ุชุนููู ูููุงุนุงุช ุงูุงูุชุฑุงุถูุฉ
function resetToDefault() {
  if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุฅุนุงุฏุฉ ุชุนููู ุฌููุน ุงููุงุนุงุช ููุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉุ\nุณูุชู ููุฏุงู ุฌููุน ุงููุงุนุงุช ุงููุฎุตุตุฉ.')) {
    rooms = ['ุงููุฎุชุจุฑ', 'ูุงุนุฉ ุงูุญุงุณูุจ', 'ุงูููุชุจุฉ', 'ุงููุงุนุฉ ุงูุฑุฆูุณูุฉ', 'ุงููุงุนุฉ ุงูุฐููุฉ', 'ุบุฑูุฉ ุตููุฉ'];
    saveRooms();
    displayRooms();
    alert('โ ุชู ุฅุนุงุฏุฉ ุชุนููู ุงููุงุนุงุช ููุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ (6 ูุงุนุงุช)');
  }
}

// ุนุฑุถ ูุนูููุงุช ุญุงูุฉ ุงูุจูุงูุงุช
function showDataStatus() {
  const lastUpdate = localStorage.getItem('school_rooms_last_update');
  const hasBackup = localStorage.getItem('school_rooms_backup');
  const currentRooms = rooms.length;
  
  let message = `๐ ุญุงูุฉ ุจูุงูุงุช ุงููุงุนุงุช:\n`;
  message += `โข ุนุฏุฏ ุงููุงุนุงุช ุงูุญุงููุฉ: ${currentRooms}\n`;
  message += `โข ุขุฎุฑ ุชุญุฏูุซ: ${lastUpdate ? new Date(lastUpdate).toLocaleString('ar-SA') : 'ุบูุฑ ูุญุฏุฏ'}\n`;
  message += `โข ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ: ${hasBackup ? 'ูุชููุฑุฉ โ' : 'ุบูุฑ ูุชููุฑุฉ โ'}`;
  
  alert(message);
}

// ุฏูุงู ุฅุญุตุงุฆูุงุช ุงููุงุนุฉ
function showRoomStats(roomName) {
  const modal = document.getElementById('room-stats-modal');
  const title = document.getElementById('room-stats-title');
  const content = document.getElementById('room-stats-content');
  
  title.textContent = `๐ ุฅุญุตุงุฆูุงุช ูุงุนุฉ ${roomName}`;
  content.innerHTML = '<div style="color: #666;">ุฌุงุฑู ุชุญููู ุงูุฅุญุตุงุฆูุงุช...</div>';
  modal.style.display = 'block';
  
  // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
  setTimeout(() => {
    const stats = calculateRoomStats(roomName);
    displayRoomStatsContent(stats, roomName);
  }, 500);
}

function calculateRoomStats(roomName) {
  // ุฌูุจ ุงูุญุฌูุฒุงุช ูู localStorage
  const reservations = JSON.parse(localStorage.getItem('school_reservations') || '[]');
  const roomReservations = reservations.filter(res => res.room === roomName);
  
  if (roomReservations.length === 0) {
    return {
      totalReservations: 0,
      topTeachers: [],
      topSubjects: [],
      busyDays: [],
      weeklyActivity: {}
    };
  }
  
  // ุฃูุซุฑ ุงููุนููุงุช ุญุฌุฒุงู
  const teacherCounts = {};
  roomReservations.forEach(res => {
    teacherCounts[res.teacher] = (teacherCounts[res.teacher] || 0) + 1;
  });
  const topTeachers = Object.entries(teacherCounts)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5);
  
  // ุฃูุซุฑ ุงููุตูู ูุดุงุทุงู
  const subjectCounts = {};
  roomReservations.forEach(res => {
    subjectCounts[res.subject] = (subjectCounts[res.subject] || 0) + 1;
  });
  const topSubjects = Object.entries(subjectCounts)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5);
  
  // ุฃูุซุฑ ุงูุฃูุงู ูุดุงุทุงู
  const dayCounts = {};
  const dayNames = ['ุงูุฃุญุฏ', 'ุงูุฅุซููู', 'ุงูุซูุงุซุงุก', 'ุงูุฃุฑุจุนุงุก', 'ุงูุฎููุณ'];
  roomReservations.forEach(res => {
    const dayName = dayNames[res.day] || `ุงูููู ${res.day + 1}`;
    dayCounts[dayName] = (dayCounts[dayName] || 0) + 1;
  });
  const busyDays = Object.entries(dayCounts)
    .sort(([,a], [,b]) => b - a)
    .slice(0, 5);
  
  return {
    totalReservations: roomReservations.length,
    topTeachers,
    topSubjects,
    busyDays,
    weeklyActivity: dayCounts
  };
}

function displayRoomStatsContent(stats, roomName) {
  const content = document.getElementById('room-stats-content');
  
  if (stats.totalReservations === 0) {
    content.innerHTML = `
      <div style="text-align: center; padding: 40px;">
        <div style="font-size: 48px; margin-bottom: 20px;">๐</div>
        <h3 style="color: #666;">ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ููุฐู ุงููุงุนุฉ</h3>
        <p style="color: #999;">ูู ูุชู ุชุณุฌูู ุฃู ุญุฌูุฒุงุช ููุงุนุฉ ${roomName} ุญุชู ุงูุขู</p>
      </div>
    `;
    return;
  }
  
  content.innerHTML = `
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
      
      <!-- ุฅุฌูุงูู ุงูุญุฌูุฒุงุช -->
      <div style="background: linear-gradient(135deg, #1b3767, #2d4a7a); color: white; padding: 20px; border-radius: 8px; text-align: center;">
        <div style="font-size: 36px; margin-bottom: 10px;">๐</div>
        <h4 style="margin: 0 0 10px 0;">ุฅุฌูุงูู ุงูุญุฌูุฒุงุช</h4>
        <div style="font-size: 28px; font-weight: bold;">${stats.totalReservations}</div>
      </div>
      
      <!-- ุฃูุซุฑ ุงููุนููุงุช ุญุฌุฒุงู -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e9ecef;">
        <h4 style="color: #1b3767; margin: 0 0 15px 0; text-align: center;">๐ฉโ๐ซ ุฃูุซุฑ ุงููุนููุงุช ุญุฌุฒุงู</h4>
        ${stats.topTeachers.length > 0 ? 
          stats.topTeachers.map(([teacher, count], index) => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
              <span style="font-weight: ${index === 0 ? 'bold' : 'normal'}; color: ${index === 0 ? '#1b3767' : '#666'};">
                ${index + 1}. ${teacher}
              </span>
              <span style="background: ${index === 0 ? '#1b3767' : '#6c757d'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.9em;">
                ${count}
              </span>
            </div>
          `).join('') : 
          '<div style="text-align: center; color: #999;">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>'
        }
      </div>
      
      <!-- ุฃูุซุฑ ุงููุตูู ูุดุงุทุงู -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e9ecef;">
        <h4 style="color: #1b3767; margin: 0 0 15px 0; text-align: center;">๐ ุฃูุซุฑ ุงููุตูู ูุดุงุทุงู</h4>
        ${stats.topSubjects.length > 0 ? 
          stats.topSubjects.map(([subject, count], index) => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
              <span style="font-weight: ${index === 0 ? 'bold' : 'normal'}; color: ${index === 0 ? '#1b3767' : '#666'};">
                ${index + 1}. ${subject}
              </span>
              <span style="background: ${index === 0 ? '#28a745' : '#6c757d'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.9em;">
                ${count}
              </span>
            </div>
          `).join('') : 
          '<div style="text-align: center; color: #999;">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>'
        }
      </div>
      
      <!-- ุฃูุซุฑ ุงูุฃูุงู ูุดุงุทุงู -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e9ecef;">
        <h4 style="color: #1b3767; margin: 0 0 15px 0; text-align: center;">๐ ุฃูุซุฑ ุงูุฃูุงู ูุดุงุทุงู</h4>
        ${stats.busyDays.length > 0 ? 
          stats.busyDays.map(([day, count], index) => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #e9ecef;">
              <span style="font-weight: ${index === 0 ? 'bold' : 'normal'}; color: ${index === 0 ? '#1b3767' : '#666'};">
                ${index + 1}. ${day}
              </span>
              <span style="background: ${index === 0 ? '#17a2b8' : '#6c757d'}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.9em;">
                ${count}
              </span>
            </div>
          `).join('') : 
          '<div style="text-align: center; color: #999;">ูุง ุชูุฌุฏ ุจูุงูุงุช</div>'
        }
      </div>
      
    </div>
    
    <!-- ุฑุณู ุจูุงูู ููุฃูุงู -->
    <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 8px; border: 2px solid #e9ecef;">
      <h4 style="color: #1b3767; text-align: center; margin-bottom: 20px;">๐ ุชูุฒูุน ุงูุญุฌูุฒุงุช ุญุณุจ ุงูุฃูุงู</h4>
      <canvas id="room-days-chart" width="400" height="200"></canvas>
    </div>
  `;
  
  // ุฑุณู ุงูุฑุณู ุงูุจูุงูู
  setTimeout(() => createRoomDaysChart(stats.weeklyActivity), 100);
}

function createRoomDaysChart(weeklyActivity) {
  const canvas = document.getElementById('room-days-chart');
  if (!canvas) return;
  
  // ุชุฏููุฑ ุงูุฑุณู ุงูุจูุงูู ุงููุฏูู ุฅู ููุฌุฏ
  if (window.roomDaysChart) {
    window.roomDaysChart.destroy();
  }
  
  const days = ['ุงูุฃุญุฏ', 'ุงูุฅุซููู', 'ุงูุซูุงุซุงุก', 'ุงูุฃุฑุจุนุงุก', 'ุงูุฎููุณ'];
  const data = days.map(day => weeklyActivity[day] || 0);
  
  const ctx = canvas.getContext('2d');
  window.roomDaysChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: days,
      datasets: [{
        label: 'ุนุฏุฏ ุงูุญุฌูุฒุงุช',
        data: data,
        backgroundColor: [
          '#1b3767',
          '#2d4a7a',
          '#3e5d8d',
          '#4f70a0',
          '#6083b3'
        ],
        borderColor: '#1b3767',
        borderWidth: 1,
        borderRadius: 4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: {
            stepSize: 1,
            font: {
              family: 'Arial'
            }
          },
          grid: {
            color: '#e9ecef'
          }
        },
        x: {
          ticks: {
            font: {
              family: 'Arial',
              size: 12
            }
          },
          grid: {
            display: false
          }
        }
      },
      animation: {
        duration: 1000,
        easing: 'easeOutQuart'
      }
    }
  });
}

function closeRoomStatsModal() {
  document.getElementById('room-stats-modal').style.display = 'none';
}

function printRoomStats() {
  const roomName = document.getElementById('room-stats-title').textContent.replace('๐ ุฅุญุตุงุฆูุงุช ูุงุนุฉ ', '');
  const content = document.getElementById('room-stats-content').innerHTML;
  
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html dir="rtl">
    <head>
      <meta charset="UTF-8">
      <title>ุฅุญุตุงุฆูุงุช ูุงุนุฉ ${roomName}</title>
      <style>
        body { font-family: Arial, sans-serif; margin: 20px; direction: rtl; }
        h1 { color: #1b3767; text-align: center; }
        .no-print { display: none; }
        @media print { .no-print { display: none !important; } }
      </style>
    </head>
    <body>
      <h1>ุฅุญุตุงุฆูุงุช ูุงุนุฉ ${roomName}</h1>
      <div>${content}</div>
      <p style="text-align: center; margin-top: 30px; color: #666; font-size: 0.9em;">
        ุทูุจุนุช ูู ูุธุงู ุฒุงููุฉ - ${new Date().toLocaleDateString('ar-SA')}
      </p>
    </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}

function exportRoomStats() {
  const roomName = document.getElementById('room-stats-title').textContent.replace('๐ ุฅุญุตุงุฆูุงุช ูุงุนุฉ ', '');
  const stats = calculateRoomStats(roomName);
  
  const exportData = {
    roomName: roomName,
    exportDate: new Date().toISOString(),
    totalReservations: stats.totalReservations,
    topTeachers: stats.topTeachers,
    topSubjects: stats.topSubjects,
    busyDays: stats.busyDays,
    weeklyActivity: stats.weeklyActivity
  };
  
  const dataStr = JSON.stringify(exportData, null, 2);
  const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
  
  const exportFileDefaultName = `room-stats-${roomName}-${new Date().toISOString().split('T')[0]}.json`;
  
  const linkElement = document.createElement('a');
  linkElement.setAttribute('href', dataUri);
  linkElement.setAttribute('download', exportFileDefaultName);
  linkElement.click();
  
  alert(`โ ุชู ุชุตุฏูุฑ ุฅุญุตุงุฆูุงุช ูุงุนุฉ "${roomName}" ุจูุฌุงุญ`);
}

// ุฅุธูุงุฑ ุฒุฑ ุงููุงุฆูุฉ ูู ุงูุดุงุดุงุช ุงูุตุบูุฑุฉ ูุชุซุจูุช ูููุนู ูู ุฃุนูู ูุณุงุฑ ุงูุตูุญุฉ
function toggleMenuButton() {
	var btn = document.getElementById('menu-toggle');
	var nav = document.getElementById('nav-links');
	btn.style.position = 'fixed';
	btn.style.left = '18px';
	btn.style.top = '18px';
	btn.style.zIndex = '1100';
	if(window.innerWidth <= 768) {
		btn.style.display = 'block';
		nav.style.position = 'absolute';
		nav.style.top = '60px';
		nav.style.left = '50%';
		nav.style.transform = 'translateX(-50%)';
		nav.style.width = '90vw';
		nav.style.maxWidth = '320px';
		nav.style.background = '#fff';
		nav.style.boxShadow = '0 2px 12px #1b376722';
		nav.style.borderRadius = '12px';
		nav.style.zIndex = '1000';
	} else {
		btn.style.display = 'none';
		nav.style.position = '';
		nav.style.top = '';
		nav.style.left = '';
		nav.style.transform = '';
		nav.style.width = '';
		nav.style.maxWidth = '';
		nav.style.background = 'rgba(27,55,103,0.12)';
		nav.style.boxShadow = '0 2px 12px rgba(27,55,103,0.08)';
		nav.style.borderRadius = '16px';
		nav.style.zIndex = '';
		nav.classList.remove('show');
	}
}
window.addEventListener('resize', toggleMenuButton);
window.addEventListener('DOMContentLoaded', toggleMenuButton);
</script>
</body>
<footer style="background:rgba(27,55,103,0.08); color:#1b3767; text-align:center; padding:18px 0; font-size:1.1em; font-family:'Times New Roman', Times, serif; margin-top:40px; border-radius:0 0 16px 16px;">
	ูุตููุฉ ุงููููุน : ููุงุก ุงูุดุนูููุฉ &mdash; ูุนููุฉ ุชูููุฉ ูุนูููุงุช
</footer>
</html>
