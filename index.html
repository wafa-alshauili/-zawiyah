<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الزاوية</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <div class="corner-logos">
    <img class="logo-ministry" src="https://i.ibb.co/HfwV7QB5/ministerylogo1-1.png" alt="شعار وزارة التربية والتعليم سلطنة عمان">
  </div>
</nav>
  <main class="container">
  <div class="site-title-bar" style="text-align:center; margin: 40px auto 0 auto;">
  <span class="site-title">زاوية</span>
  <hr id="responsive-title-hr" style="display:none; border:none; border-bottom:2.5px solid #1b3767; width:70%; margin:12px auto 0 auto;">
    <button id="menu-toggle" style="display:none; background:none; border:none; position:absolute; left:18px; top:18px; z-index:1100; cursor:pointer;">
      <span style="font-size:1.5em; color:#1b3767;">&#9776;</span>
    </button>
    <ul class="nav-links" id="nav-links" style="display:flex; justify-content:center; gap:32px; list-style:none; margin:28px auto 0 auto; padding:0; background:rgba(27,55,103,0.12); border-radius:16px; box-shadow:0 2px 12px rgba(27,55,103,0.08);">
      <li><a href="index.html" class="active" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px; border-bottom: 5px solid #0d2546; box-shadow: 0 4px 0 #0d2546;">الرئيسية</a></li>
      <li><a href="reservations.html" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">الحجوزات</a></li>
      <li><a href="rooms.html" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">القاعات</a></li>
    </ul>
  </div>
  <div class="welcome-box" style="text-align:center; margin: 18px auto 32px auto; max-width: 500px; background: #fafdff; border-radius: 12px; box-shadow: 0 2px 12px #dbe3f7; padding: 18px 22px;">
  <p style="font-size:1.15em; color:#1b3767; margin-bottom:10px;">مرحبًا بك في منصة زاوية لحجز القاعات المدرسية!</p>
  <p style="font-size:1em; color:#254a8a; margin-bottom:18px;">يهدف الموقع إلى تسهيل عملية حجز القاعات وإدارتها إلكترونيًا في <br>مدرسة بسياء للتعليم الأساسي (5-12) مع توفير تجربة سهلة لجميع المستخدمين في بيئة تعليمية متكاملة.</p>
    <button onclick="window.location.href='reservations.html'" style="background:#1b3767; color:#fff; border:none; border-radius:7px; padding:10px 28px; font-size:1.1em; font-weight:bold; cursor:pointer; box-shadow:0 2px 8px #dbe3f7;">الانتقال إلى صفحة الحجوزات</button>
  </div>

  <!-- لوحة التحكم والإحصائيات -->
  <div class="dashboard" style="margin: 30px auto; max-width: 800px;">
    <h2 style="text-align: center; color: #1b3767; margin-bottom: 25px;">📊 لوحة التحكم</h2>
    
    <!-- بطاقات الإحصائيات -->
    <div class="stats-cards" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
      <div class="stat-card" style="background: #e3f2fd; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="font-size: 2.5em; color: #1976d2; margin-bottom: 10px;">🏢</div>
        <div style="font-size: 1.8em; font-weight: bold; color: #1976d2;" id="total-rooms">0</div>
        <div style="color: #555; margin-top: 5px;">إجمالي القاعات</div>
      </div>
      
      <div class="stat-card" style="background: #e8f5e8; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="font-size: 2.5em; color: #4caf50; margin-bottom: 10px;">📅</div>
        <div style="font-size: 1.8em; font-weight: bold; color: #4caf50;" id="total-reservations">0</div>
        <div style="color: #555; margin-top: 5px;">إجمالي الحجوزات</div>
      </div>
      
      <div class="stat-card" style="background: #fff3e0; border-radius: 12px; padding: 20px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <div style="font-size: 2.5em; color: #ff9800; margin-bottom: 10px;">📈</div>
        <div style="font-size: 1.8em; font-weight: bold; color: #ff9800;" id="this-week-reservations">0</div>
        <div style="color: #555; margin-top: 5px;">حجوزات هذا الأسبوع</div>
      </div>
    </div>

    <!-- الروابط السريعة -->
    <div class="quick-actions" style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h3 style="color: #1b3767; margin-bottom: 20px; text-align: center;">⚡ الإجراءات السريعة</h3>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
        <button onclick="window.location.href='reservations.html'" 
                style="background: #1b3767; color: white; border: none; padding: 15px 20px; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.3s;">
          📅 حجز قاعة جديدة
        </button>
        <button onclick="window.location.href='rooms.html'" 
                style="background: #4caf50; color: white; border: none; padding: 15px 20px; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.3s;">
          🏢 إدارة القاعات
        </button>
        <button onclick="exportAllData()" 
                style="background: #ff9800; color: white; border: none; padding: 15px 20px; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.3s;">
          📊 تصدير البيانات
        </button>
      </div>
    </div>

    <!-- أحدث الحجوزات -->
    <div class="recent-bookings" style="background: white; border-radius: 12px; padding: 25px; margin-top: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <h3 style="color: #1b3767; margin-bottom: 20px; text-align: center;">🕒 أحدث الحجوزات</h3>
      <div id="recent-bookings-list" style="max-height: 300px; overflow-y: auto;">
        <div style="text-align: center; color: #666; padding: 20px; font-style: italic;">لا توجد حجوزات حديثة</div>
      </div>
    </div>
  </div>
</main>

<script src="script.js"></script>
<script>
// تحديث لوحة التحكم
function updateDashboard() {
  // تحميل البيانات
  const savedRooms = localStorage.getItem('school_rooms');
  const rooms = savedRooms ? JSON.parse(savedRooms) : [];
  
  const savedReservations = localStorage.getItem('school_reservations');
  const reservations = savedReservations ? JSON.parse(savedReservations) : [];
  
  // تحديث إجمالي القاعات
  document.getElementById('total-rooms').textContent = rooms.length;
  
  // تحديث إجمالي الحجوزات
  document.getElementById('total-reservations').textContent = reservations.length;
  
  // حساب حجوزات هذا الأسبوع
  const today = new Date();
  const weekStart = new Date(today);
  weekStart.setDate(today.getDate() - today.getDay());
  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 6);
  
  const thisWeekReservations = reservations.filter(r => {
    const reservationDate = new Date(r.date);
    return reservationDate >= weekStart && reservationDate <= weekEnd;
  });
  
  document.getElementById('this-week-reservations').textContent = thisWeekReservations.length;
  
  // عرض أحدث الحجوزات
  const recentBookingsList = document.getElementById('recent-bookings-list');
  if (reservations.length === 0) {
    recentBookingsList.innerHTML = '<div style="text-align: center; color: #666; padding: 20px; font-style: italic;">لا توجد حجوزات حديثة</div>';
  } else {
    const recentReservations = reservations
      .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
      .slice(0, 5);
    
    recentBookingsList.innerHTML = recentReservations.map(r => `
      <div style="border-bottom: 1px solid #eee; padding: 10px 0; display: flex; justify-content: space-between; align-items: center;">
        <div>
          <div style="font-weight: bold; color: #1b3767;">${r.room}</div>
          <div style="color: #666; font-size: 0.9em;">${r.teacher} - ${r.subject}</div>
        </div>
        <div style="text-align: right; font-size: 0.85em; color: #888;">
          ${new Date(r.date).toLocaleDateString('ar-SA')}
        </div>
      </div>
    `).join('');
  }
}

// تصدير جميع البيانات
function exportAllData() {
  const savedRooms = localStorage.getItem('school_rooms');
  const rooms = savedRooms ? JSON.parse(savedRooms) : [];
  
  const savedReservations = localStorage.getItem('school_reservations');
  const reservations = savedReservations ? JSON.parse(savedReservations) : [];
  
  if (reservations.length === 0) {
    alert('⚠️ لا توجد بيانات للتصدير');
    return;
  }
  
  const csvContent = "data:text/csv;charset=utf-8," + 
    "التاريخ,اليوم,القاعة,المعلم,المادة,وقت الإنشاء\n" +
    reservations.map(r => {
      const date = new Date(r.date);
      const dayName = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس'][date.getDay()];
      const createdDate = new Date(r.createdAt);
      return `${date.toLocaleDateString('ar-SA')},${dayName},${r.room},${r.teacher},${r.subject},${createdDate.toLocaleDateString('ar-SA')}`;
    }).join("\n");
  
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", `تقرير_شامل_${new Date().toLocaleDateString('ar-SA')}.csv`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  alert('✅ تم تصدير البيانات بنجاح!');
}

// تحديث لوحة التحكم عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', function() {
  updateDashboard();
  
  // تحديث البيانات كل 5 ثوانٍ في حالة تم التعديل من صفحة أخرى
  setInterval(updateDashboard, 5000);
});

// إظهار زر القائمة في الشاشات الصغيرة وتثبيت موقعه في أعلى يسار الصفحة
function toggleMenuButton() {
  var btn = document.getElementById('menu-toggle');
  var nav = document.getElementById('nav-links');
  var hr = document.getElementById('responsive-title-hr');
  btn.style.position = 'fixed';
  btn.style.left = '18px';
  btn.style.top = '18px';
  btn.style.zIndex = '1100';
  if(window.innerWidth <= 768) {
    btn.style.display = 'block';
    nav.style.position = 'absolute';
    nav.style.top = '60px';
    nav.style.left = '50%';
    nav.style.transform = 'translateX(-50%)';
    nav.style.width = '90vw';
    nav.style.maxWidth = '320px';
    nav.style.background = '#fff';
    nav.style.boxShadow = '0 2px 12px #1b376722';
    nav.style.borderRadius = '12px';
    nav.style.zIndex = '1000';
    hr.style.display = 'block';
  } else {
    btn.style.display = 'none';
    nav.style.position = '';
    nav.style.top = '';
    nav.style.left = '';
    nav.style.transform = '';
    nav.style.width = '';
    nav.style.maxWidth = '';
    nav.style.background = 'rgba(27,55,103,0.12)';
    nav.style.boxShadow = '0 2px 12px rgba(27,55,103,0.08)';
    nav.style.borderRadius = '16px';
    nav.style.zIndex = '';
    nav.classList.remove('show');
    hr.style.display = 'none';
  }
}
window.addEventListener('resize', toggleMenuButton);
window.addEventListener('DOMContentLoaded', toggleMenuButton);
</script>
</body>
<footer style="background:rgba(27,55,103,0.08); color:#1b3767; text-align:center; padding:18px 0; font-size:1.1em; font-family:'Times New Roman', Times, serif; margin-top:40px; border-radius:0 0 16px 16px;">
  مصممة الموقع : وفاء الشعيلية &mdash; معلمة تقنية معلومات<br>
  <span style="font-size:0.98em; color:#254a8a;">الموقع قيد التجربة لذا نرحب بجميع الملاحظات</span>
</footer>
</html>
