<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .test-section { 
            background: #f8f9fa; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .reservation-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #667eea;
            margin: 15px 0;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            color: #667eea;
        }
        .form-group select, .form-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .info { color: #17a2b8; font-weight: bold; }
        button { 
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white; 
            border: none; 
            padding: 12px 24px; 
            margin: 8px; 
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .reservation-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .reservation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .reservation-title {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
        }
        .reservation-date {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .reservation-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 14px;
        }
        .detail-item {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
        }
        .detail-label {
            font-weight: bold;
            color: #666;
            display: block;
            font-size: 12px;
        }
        .stats-card {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
        }
        .stats-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        #results { 
            background: white; 
            border: 1px solid #ddd; 
            padding: 20px; 
            margin-top: 20px; 
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 13px;
        }
        .sync-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .sync-active { background: #28a745; }
        .sync-inactive { background: #dc3545; }
        .sync-syncing { background: #ffc107; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù… ÙˆØ§Ù„ØªÙˆØ§Ø±ÙŠØ®</p>
            <div id="sync-status">
                <span class="sync-indicator sync-inactive"></span>
                Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...
            </div>
        </div>

        <div class="test-grid">
            <!-- Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ -->
            <div class="test-section">
                <h2>ğŸ“… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ</h2>
                <div class="reservation-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
                            <select id="test-subject">
                                <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                                <option value="Ø§Ù„Ø¹Ù„ÙˆÙ…">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
                                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                                <option value="Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡">Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</option>
                                <option value="Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡">Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</option>
                                <option value="Ø§Ù„ØªØ§Ø±ÙŠØ®">Ø§Ù„ØªØ§Ø±ÙŠØ®</option>
                                <option value="Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§">Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…:</label>
                            <input type="text" id="test-teacher" placeholder="Ø£. Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯" value="Ø£. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø¯Ø±Ø¬Ø©:</label>
                            <select id="test-grade">
                                <option value="5">Ø§Ù„Ø®Ø§Ù…Ø³</option>
                                <option value="6">Ø§Ù„Ø³Ø§Ø¯Ø³</option>
                                <option value="7">Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
                                <option value="8">Ø§Ù„Ø«Ø§Ù…Ù†</option>
                                <option value="9">Ø§Ù„ØªØ§Ø³Ø¹</option>
                                <option value="10">Ø§Ù„Ø¹Ø§Ø´Ø±</option>
                                <option value="11">Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option>
                                <option value="12">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚Ø³Ù…:</label>
                            <select id="test-section">
                                <option value="Ø£">Ø£</option>
                                <option value="Ø¨">Ø¨</option>
                                <option value="Ø¬">Ø¬</option>
                                <option value="Ø¯">Ø¯</option>
                                <option value="Ù‡">Ù‡</option>
                                <option value="Ùˆ">Ùˆ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                            <input type="date" id="test-date" value="">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„ÙˆÙ‚Øª:</label>
                            <select id="test-time">
                                <option value="07:30-08:15">07:30-08:15</option>
                                <option value="08:15-09:00">08:15-09:00</option>
                                <option value="09:00-09:45">09:00-09:45</option>
                                <option value="09:45-10:30">09:45-10:30</option>
                                <option value="11:00-11:45">11:00-11:45</option>
                                <option value="11:45-12:30">11:45-12:30</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                            <input type="tel" id="test-phone" placeholder="99887766" value="99887766">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù‚Ø§Ø¹Ø©:</label>
                            <select id="test-room">
                                <option value="room1">Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø®ØªØ¨Ø±</option>
                                <option value="room2">Ù‚Ø§Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                                <option value="room3">Ù‚Ø§Ø¹Ø© Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
                                <option value="room4">Ù‚Ø§Ø¹Ø© Ø§Ù„Ù„ØºØ§Øª</option>
                            </select>
                        </div>
                    </div>
                    <button onclick="createTestReservation()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²</button>
                    <button onclick="createMultipleReservations()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬ÙˆØ²Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©</button>
                </div>
            </div>

            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª -->
            <div class="test-section">
                <h2>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
                <div class="stats-card">
                    <div class="stats-number" id="total-reservations">0</div>
                    <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div class="stats-card" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                        <div class="stats-number" id="today-reservations">0</div>
                        <div style="font-size: 12px;">Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                    <div class="stats-card" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                        <div class="stats-number" id="firebase-reservations">0</div>
                        <div style="font-size: 12px;">ÙÙŠ Firebase</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div class="test-section full-width">
            <h2>ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
            <button onclick="testReservationSync()">Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</button>
            <button onclick="testConflictResolution()">Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª</button>
            <button onclick="testDateTimeSync()">Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</button>
            <button onclick="testGradeSystemSync()">Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
            <button onclick="testBulkSync()">Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ¨ÙŠØ±Ø©</button>
            <button onclick="testOfflineMode()">Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <button onclick="clearReservations()">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</button>
        </div>

        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª -->
        <div class="test-section full-width">
            <h2>ğŸ“‹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
            <div id="reservations-display">
                <p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
            </div>
        </div>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª -->
        <div id="results"></div>
    </div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        window.FIREBASE_ENABLED = true;
        window.FIREBASE_READY = false;

        const firebaseConfig = {
            apiKey: "AIzaSyCddo_kfYs8wO_xzZgf2WsWDvBWW8wC8rE",
            authDomain: "zawiyah-76151.firebaseapp.com",
            projectId: "zawiyah-76151",
            storageBucket: "zawiyah-76151.appspot.com",
            messagingSenderId: "259480775839",
            appId: "1:259480775839:web:0a95d39bfeb45f4c3abd83"
        };

        try {
            if (window.FIREBASE_ENABLED && typeof firebase !== 'undefined') {
                firebase.initializeApp(firebaseConfig);
                window.db = firebase.firestore();
                window.FIREBASE_READY = true;
            }
        } catch (error) {
            console.warn('âš ï¸ ÙØ´Ù„ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Firebase:', error);
            window.FIREBASE_ENABLED = false;
            window.FIREBASE_READY = false;
        }

        function isFirebaseReady() {
            return window.FIREBASE_ENABLED && window.FIREBASE_READY && window.db;
        }

        function disableFirebase() {
            window.FIREBASE_ENABLED = false;
            window.FIREBASE_READY = false;
        }

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const time = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : 
                            type === 'error' ? 'error' : 
                            type === 'warning' ? 'warning' : 'info';
            
            results.innerHTML += `<div><span class="${className}">${time}: ${message}</span></div>`;
            results.scrollTop = results.scrollHeight;
            console.log(message);
        }

        function updateSyncStatus(status) {
            const indicator = document.querySelector('.sync-indicator');
            const statusText = document.getElementById('sync-status');
            
            if (status === 'active') {
                indicator.className = 'sync-indicator sync-active';
                statusText.innerHTML = '<span class="sync-indicator sync-active"></span>Ù…ØªØµÙ„ ÙˆÙ…ØªØ²Ø§Ù…Ù†';
            } else if (status === 'syncing') {
                indicator.className = 'sync-indicator sync-syncing';
                statusText.innerHTML = '<span class="sync-indicator sync-syncing"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
            } else {
                indicator.className = 'sync-indicator sync-inactive';
                statusText.innerHTML = '<span class="sync-indicator sync-inactive"></span>ØºÙŠØ± Ù…ØªØµÙ„ - ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹';
            }
        }
    </script>

    <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <script src="dataManager.js"></script>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª -->
    <script src="conflictPrevention.js"></script>

    <script>
        let reservationIdCounter = 1;

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', async function() {
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
            document.getElementById('test-date').value = new Date().toISOString().split('T')[0];
            
            log('ğŸ”„ ØªÙ‡ÙŠØ¦Ø© ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...');
            
            // Ø§Ù†ØªØ¸Ø§Ø± ØªÙ‡ÙŠØ¦Ø© Ù…Ø¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            updateStats();
            displayReservations();
            updateSyncStatus(isFirebaseReady() ? 'active' : 'inactive');
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
            setInterval(() => {
                updateStats();
                displayReservations();
            }, 10000);
        });

        async function createTestReservation() {
            log('ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ...');
            updateSyncStatus('syncing');

            try {
                const reservation = {
                    id: 'reservation_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    subject: document.getElementById('test-subject').value,
                    teacher: document.getElementById('test-teacher').value,
                    grade: document.getElementById('test-grade').value,
                    section: document.getElementById('test-section').value,
                    date: document.getElementById('test-date').value,
                    time: document.getElementById('test-time').value,
                    phone: document.getElementById('test-phone').value,
                    room: document.getElementById('test-room').value,
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ
                    hijriDate: convertToHijri(new Date(document.getElementById('test-date').value)),
                    // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
                    testData: true,
                    syncAttempts: 0
                };

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¬Ø² Ù„Ù„Ù†Ø¸Ø§Ù…
                const reservations = await window.dataManager.getData('reservations');
                reservations.push(reservation);
                
                const success = await window.dataManager.saveData('reservations', reservations);
                
                if (success) {
                    log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­: ${reservation.subject} - ${reservation.grade}${reservation.section}`, 'success');
                    updateStats();
                    displayReservations();
                    updateSyncStatus('active');
                } else {
                    log('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²', 'error');
                    updateSyncStatus('inactive');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø²: ${error.message}`, 'error');
                updateSyncStatus('inactive');
            }
        }

        async function createMultipleReservations() {
            log('ğŸ”„ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬ÙˆØ²Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±...');
            updateSyncStatus('syncing');

            try {
                const subjects = ['Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª', 'Ø§Ù„Ø¹Ù„ÙˆÙ…', 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', 'Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©', 'Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡'];
                const grades = ['10', '11', '12'];
                const sections = ['Ø£', 'Ø¨', 'Ø¬'];
                const times = ['07:30-08:15', '08:15-09:00', '09:00-09:45', '09:45-10:30'];
                
                const reservations = await window.dataManager.getData('reservations');
                
                for (let i = 0; i < 5; i++) {
                    const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
                    const randomGrade = grades[Math.floor(Math.random() * grades.length)];
                    const randomSection = sections[Math.floor(Math.random() * sections.length)];
                    const randomTime = times[Math.floor(Math.random() * times.length)];
                    
                    // ØªØ§Ø±ÙŠØ® Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…
                    const randomDate = new Date();
                    randomDate.setDate(randomDate.getDate() + Math.floor(Math.random() * 7));
                    
                    const reservation = {
                        id: 'multi_reservation_' + Date.now() + '_' + i,
                        subject: randomSubject,
                        teacher: `Ø£. Ù…Ø¹Ù„Ù… ${i + 1}`,
                        grade: randomGrade,
                        section: randomSection,
                        date: randomDate.toISOString().split('T')[0],
                        time: randomTime,
                        phone: `9988${7700 + i}`,
                        room: `room${(i % 4) + 1}`,
                        created: new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        hijriDate: convertToHijri(randomDate),
                        testData: true,
                        batchNumber: Math.floor(Date.now() / 1000)
                    };
                    
                    reservations.push(reservation);
                }
                
                const success = await window.dataManager.saveData('reservations', reservations);
                
                if (success) {
                    log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ 5 Ø­Ø¬ÙˆØ²Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    updateStats();
                    displayReservations();
                    updateSyncStatus('active');
                } else {
                    log('âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©', 'error');
                    updateSyncStatus('inactive');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©: ${error.message}`, 'error');
                updateSyncStatus('inactive');
            }
        }

        async function testReservationSync() {
            log('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø¹ Firebase...');
            updateSyncStatus('syncing');
            
            if (!isFirebaseReady()) {
                log('âš ï¸ Firebase ØºÙŠØ± Ù…ØªØ§Ø­ Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'warning');
                updateSyncStatus('inactive');
                return;
            }

            try {
                const reservations = await window.dataManager.getData('reservations');
                
                // Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù€ Firebase
                const success = await window.dataManager.saveToFirebase('reservations', reservations);
                
                if (success) {
                    log('âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø¹ Firebase Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                    const firebaseData = await window.dataManager.getFromFirebase('reservations');
                    log(`ğŸ“Š ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚: ${firebaseData.length} Ø­Ø¬Ø² ÙÙŠ Firebase`, 'info');
                    
                    updateSyncStatus('active');
                } else {
                    log('âŒ ÙØ´Ù„ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ù…Ø¹ Firebase', 'error');
                    updateSyncStatus('inactive');
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: ${error.message}`, 'error');
                updateSyncStatus('inactive');
            }
        }

        async function testConflictResolution() {
            log('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù„ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª...');
            
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ù…Ø­Ù„ÙŠ
                const localReservations = await window.dataManager.getData('reservations');
                const conflictId = 'conflict_test_' + Date.now();
                
                const localReservation = {
                    id: conflictId,
                    subject: 'Ù…Ø§Ø¯Ø© Ù…Ø­Ù„ÙŠØ©',
                    teacher: 'Ø£. Ù…Ø­Ù„ÙŠ',
                    grade: '10',
                    section: 'Ø£',
                    date: new Date().toISOString().split('T')[0],
                    time: '08:15-09:00',
                    phone: '11223344',
                    room: 'room1',
                    lastModified: new Date().toISOString(),
                    testConflict: 'local'
                };
                
                localReservations.push(localReservation);
                await window.dataManager.saveToLocalStorage('reservations', localReservations);
                log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ù…Ø­Ù„ÙŠ Ù…ØªØ¹Ø§Ø±Ø¶', 'success');
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ù…Ø®ØªÙ„Ù ÙÙŠ Firebase
                if (isFirebaseReady()) {
                    const firebaseReservations = [...localReservations];
                    const firebaseIndex = firebaseReservations.findIndex(r => r.id === conflictId);
                    
                    if (firebaseIndex !== -1) {
                        firebaseReservations[firebaseIndex] = {
                            ...firebaseReservations[firebaseIndex],
                            subject: 'Ù…Ø§Ø¯Ø© Firebase',
                            teacher: 'Ø£. Firebase',
                            testConflict: 'firebase',
                            lastModified: new Date(Date.now() + 1000).toISOString() // Ø£Ø­Ø¯Ø« Ø¨Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
                        };
                    }
                    
                    await window.dataManager.saveToFirebase('reservations', firebaseReservations);
                    log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Firebase Ù…ØªØ¹Ø§Ø±Ø¶', 'success');
                    
                    // ØªØ´ØºÙŠÙ„ Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª
                    await window.dataManager.syncDataInBackground('reservations');
                    log('âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø¢Ù„ÙŠØ© Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª', 'success');
                    
                    displayReservations();
                }
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø­Ù„ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª: ${error.message}`, 'error');
            }
        }

        async function testDateTimeSync() {
            log('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® (Ù…ÙŠÙ„Ø§Ø¯ÙŠ + Ù‡Ø¬Ø±ÙŠ)...');
            
            try {
                const reservations = await window.dataManager.getData('reservations');
                
                // ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙˆØ§Ø±ÙŠØ® Ù‡Ø¬Ø±ÙŠØ©
                const hijriReservations = reservations.filter(r => r.hijriDate);
                log(`ğŸ“… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${hijriReservations.length} Ø­Ø¬Ø² ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ù‡Ø¬Ø±ÙŠ`, 'info');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
                hijriReservations.forEach(reservation => {
                    const gregorianDate = new Date(reservation.date);
                    log(`ğŸ“† ${reservation.subject}: Ù…ÙŠÙ„Ø§Ø¯ÙŠ ${reservation.date} = Ù‡Ø¬Ø±ÙŠ ${reservation.hijriDate}`, 'info');
                });
                
                // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase
                if (isFirebaseReady()) {
                    await window.dataManager.saveToFirebase('reservations', reservations);
                    log('âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ø¹ Firebase Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®: ${error.message}`, 'error');
            }
        }

        async function testGradeSystemSync() {
            log('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…...');
            
            try {
                const reservations = await window.dataManager.getData('reservations');
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                const gradeStats = {};
                const sectionStats = {};
                
                reservations.forEach(reservation => {
                    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø§Øª
                    if (!gradeStats[reservation.grade]) {
                        gradeStats[reservation.grade] = 0;
                    }
                    gradeStats[reservation.grade]++;
                    
                    // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
                    if (!sectionStats[reservation.section]) {
                        sectionStats[reservation.section] = 0;
                    }
                    sectionStats[reservation.section]++;
                });
                
                log('ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¯Ø±Ø¬Ø§Øª:', 'info');
                Object.entries(gradeStats).forEach(([grade, count]) => {
                    log(`   Ø§Ù„ØµÙ ${grade}: ${count} Ø­Ø¬Ø²`, 'info');
                });
                
                log('ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…:', 'info');
                Object.entries(sectionStats).forEach(([section, count]) => {
                    log(`   Ø§Ù„Ù‚Ø³Ù… ${section}: ${count} Ø­Ø¬Ø²`, 'info');
                });
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (5-10: 3 Ø£Ù‚Ø³Ø§Ù…ØŒ 11-12: 6 Ø£Ù‚Ø³Ø§Ù…)
                const invalidSections = reservations.filter(r => {
                    const grade = parseInt(r.grade);
                    const section = r.section;
                    
                    if (grade >= 5 && grade <= 10) {
                        return !['Ø£', 'Ø¨', 'Ø¬'].includes(section);
                    } else if (grade >= 11 && grade <= 12) {
                        return !['Ø£', 'Ø¨', 'Ø¬', 'Ø¯', 'Ù‡', 'Ùˆ'].includes(section);
                    }
                    return false;
                });
                
                if (invalidSections.length > 0) {
                    log(`âš ï¸ ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${invalidSections.length} Ø­Ø¬Ø² Ø¨Ø£Ù‚Ø³Ø§Ù… ØºÙŠØ± ØµØ­ÙŠØ­Ø©`, 'warning');
                } else {
                    log('âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ØµØ­ÙŠØ­Ø© Ø­Ø³Ø¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©', 'success');
                }
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¬Ø§Øª: ${error.message}`, 'error');
            }
        }

        async function testBulkSync() {
            log('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ¨ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª...');
            updateSyncStatus('syncing');
            
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ 20 Ø­Ø¬Ø² ØªØ¬Ø±ÙŠØ¨ÙŠ
                const reservations = await window.dataManager.getData('reservations');
                const startCount = reservations.length;
                
                for (let i = 0; i < 20; i++) {
                    const bulkReservation = {
                        id: 'bulk_' + Date.now() + '_' + i,
                        subject: `Ù…Ø§Ø¯Ø© Ù…Ø¬Ù…Ø¹Ø© ${i + 1}`,
                        teacher: `Ø£. Ù…Ø¬Ù…Ø¹ ${i + 1}`,
                        grade: String(Math.floor(Math.random() * 8) + 5), // 5-12
                        section: ['Ø£', 'Ø¨', 'Ø¬'][Math.floor(Math.random() * 3)],
                        date: new Date(Date.now() + (i * 24 * 60 * 60 * 1000)).toISOString().split('T')[0],
                        time: '08:15-09:00',
                        phone: `998877${String(i).padStart(2, '0')}`,
                        room: `room${(i % 4) + 1}`,
                        created: new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        bulkTest: true
                    };
                    
                    reservations.push(bulkReservation);
                }
                
                // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹
                await window.dataManager.saveData('reservations', reservations);
                log(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ${reservations.length - startCount} Ø­Ø¬Ø² Ø¥Ø¶Ø§ÙÙŠ Ù…Ø­Ù„ÙŠØ§Ù‹`, 'success');
                
                // Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Firebase
                if (isFirebaseReady()) {
                    const syncSuccess = await window.dataManager.saveToFirebase('reservations', reservations);
                    if (syncSuccess) {
                        log('âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø© Ù…Ø¹ Firebase Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        updateSyncStatus('active');
                    } else {
                        log('âŒ ÙØ´Ù„ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©', 'error');
                        updateSyncStatus('inactive');
                    }
                }
                
                updateStats();
                displayReservations();
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©: ${error.message}`, 'error');
                updateSyncStatus('inactive');
            }
        }

        async function testOfflineMode() {
            log('ğŸ”„ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„...');
            
            // Ø¥ÙŠÙ‚Ø§Ù Firebase Ù…Ø¤Ù‚ØªØ§Ù‹
            const wasEnabled = window.FIREBASE_ENABLED;
            disableFirebase();
            if (window.dataManager) {
                window.dataManager.disableFirebase();
            }
            updateSyncStatus('inactive');
            log('âš ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Firebase - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ', 'warning');
            
            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„
                const offlineReservation = {
                    id: 'offline_test_' + Date.now(),
                    subject: 'Ø­Ø¬Ø² Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„',
                    teacher: 'Ø£. Ù…Ø­Ù„ÙŠ',
                    grade: '11',
                    section: 'Ø¨',
                    date: new Date().toISOString().split('T')[0],
                    time: '09:00-09:45',
                    phone: '99887744',
                    room: 'room2',
                    created: new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    offlineCreated: true
                };
                
                const reservations = await window.dataManager.getData('reservations');
                reservations.push(offlineReservation);
                await window.dataManager.saveData('reservations', reservations);
                
                log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„', 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Firebase Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(async () => {
                    window.FIREBASE_ENABLED = wasEnabled;
                    if (window.db && wasEnabled) {
                        window.FIREBASE_READY = true;
                        if (window.dataManager) {
                            window.dataManager.checkFirebaseAvailability();
                        }
                    }
                    
                    updateSyncStatus('active');
                    log('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Firebase', 'success');
                    
                    // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    if (isFirebaseReady()) {
                        const syncSuccess = await window.dataManager.forceSyncAll();
                        if (syncSuccess) {
                            log('âœ… ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ù…Ø¹ Firebase Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        }
                    }
                    
                    updateStats();
                    displayReservations();
                }, 3000);
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        async function clearReservations() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§ØªØŸ')) return;
            
            log('ğŸ”„ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª...');
            
            try {
                await window.dataManager.saveData('reservations', []);
                
                if (isFirebaseReady()) {
                    await window.dataManager.saveToFirebase('reservations', []);
                }
                
                log('âœ… ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateStats();
                displayReservations();
            } catch (error) {
                log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø³Ø­ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª: ${error.message}`, 'error');
            }
        }

        async function updateStats() {
            try {
                const reservations = await window.dataManager.getData('reservations');
                
                // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
                document.getElementById('total-reservations').textContent = reservations.length;
                
                // Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…
                const today = new Date().toISOString().split('T')[0];
                const todayReservations = reservations.filter(r => r.date === today);
                document.getElementById('today-reservations').textContent = todayReservations.length;
                
                // Ø­Ø¬ÙˆØ²Ø§Øª Firebase (Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­)
                if (isFirebaseReady()) {
                    try {
                        const firebaseReservations = await window.dataManager.getFromFirebase('reservations');
                        document.getElementById('firebase-reservations').textContent = firebaseReservations.length;
                    } catch (error) {
                        document.getElementById('firebase-reservations').textContent = 'Ø®Ø·Ø£';
                    }
                } else {
                    document.getElementById('firebase-reservations').textContent = 'ØºÙŠØ± Ù…ØªØ§Ø­';
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }

        async function displayReservations() {
            try {
                const reservations = await window.dataManager.getData('reservations');
                const displayDiv = document.getElementById('reservations-display');
                
                if (reservations.length === 0) {
                    displayDiv.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                    return;
                }
                
                // ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
                reservations.sort((a, b) => {
                    if (a.date !== b.date) {
                        return new Date(a.date) - new Date(b.date);
                    }
                    return a.time.localeCompare(b.time);
                });
                
                let html = '';
                reservations.forEach((reservation, index) => {
                    html += `
                        <div class="reservation-card">
                            <div class="reservation-header">
                                <div class="reservation-title">${reservation.subject}</div>
                                <div class="reservation-date">${reservation.date}</div>
                            </div>
                            <div class="reservation-details">
                                <div class="detail-item">
                                    <span class="detail-label">Ø§Ù„Ù…Ø¹Ù„Ù…</span>
                                    ${reservation.teacher}
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ø§Ù„ØµÙ ÙˆØ§Ù„Ù‚Ø³Ù…</span>
                                    ${reservation.grade}${reservation.section}
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ø§Ù„ÙˆÙ‚Øª</span>
                                    ${reservation.time}
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ø§Ù„Ù‚Ø§Ø¹Ø©</span>
                                    ${reservation.room}
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Ø§Ù„Ù‡Ø§ØªÙ</span>
                                    ${reservation.phone}
                                </div>
                                ${reservation.hijriDate ? `
                                <div class="detail-item">
                                    <span class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ</span>
                                    ${reservation.hijriDate}
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                displayDiv.innerHTML = html;
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª:', error);
                document.getElementById('reservations-display').innerHTML = 
                    '<p style="color: red;">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</p>';
            }
        }

        // Ø¯Ø§Ù„Ø© ØªØ­ÙˆÙŠÙ„ Ø¨Ø³ÙŠØ·Ø© Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ (ØªÙ‚Ø±ÙŠØ¨ÙŠØ©)
        function convertToHijri(gregorianDate) {
            // Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© ØªÙ‚Ø±ÙŠØ¨ÙŠØ© - ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙØ¶Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…ØªØ®ØµØµØ©
            const hijriYear = Math.floor(((gregorianDate.getFullYear() - 622) * 365.25) / 354.37) + 1;
            const hijriMonth = Math.floor(Math.random() * 12) + 1; // ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            const hijriDay = Math.floor(Math.random() * 29) + 1; // ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
            
            const monthNames = [
                'Ù…Ø­Ø±Ù…', 'ØµÙØ±', 'Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„', 'Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', 'Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰', 'Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø«Ø§Ù†ÙŠØ©',
                'Ø±Ø¬Ø¨', 'Ø´Ø¹Ø¨Ø§Ù†', 'Ø±Ù…Ø¶Ø§Ù†', 'Ø´ÙˆØ§Ù„', 'Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©', 'Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©'
            ];
            
            return `${hijriDay} ${monthNames[hijriMonth - 1]} ${hijriYear}Ù‡Ù€`;
        }
    </script>
</body>
</html>