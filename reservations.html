<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Arabic+Poetry:opsz,wght@16..72,400;16..72,700&display=swap" rel="stylesheet">
</head>
<body>
<nav class="navbar">
	<div class="corner-logos">
		<img class="logo-ministry" src="https://i.ibb.co/HfwV7QB5/ministerylogo1-1.png" alt="Ø´Ø¹Ø§Ø± ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ… Ø³Ù„Ø·Ù†Ø© Ø¹Ù…Ø§Ù†">
	</div>
</nav>

<main class="container">
		<div class="site-title-bar" style="text-align:center; margin: 40px auto 0 auto;">
					<span class="site-title">Ø²Ø§ÙˆÙŠØ©</span>
					<button id="menu-toggle" style="display:none; background:none; border:none; position:absolute; left:18px; top:18px; z-index:1100; cursor:pointer;">
				<span style="font-size:1.5em; color:#1b3767;">&#9776;</span>
					</button>
					<ul class="nav-links" id="nav-links" style="display:flex; justify-content:center; gap:32px; list-style:none; margin:28px auto 0 auto; padding:0; background:rgba(27,55,103,0.12); border-radius:16px; box-shadow:0 2px 12px rgba(27,55,103,0.08);">
			<li><a href="index.html" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
			<li><a href="reservations.html" class="active" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</a></li>
			<li><a href="rooms.html" style="font-size:1.2em; font-family:'Times New Roman', Times, serif; color:#1b3767; font-weight:bold; padding:10px 24px; border-radius:8px;">Ø§Ù„Ù‚Ø§Ø¹Ø§Øª</a></li>
			</ul>
		</div>

<main class="container">
	<h1 class="main-title">Ø²Ø§ÙˆÙŠØ©</h1>

<h2>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
<div id="week-controls" style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
		<button id="prev-week">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
		<span id="week-range" style="font-weight: bold;"></span>
		<button id="next-week">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ù„ÙŠ</button>
		<label style="margin-right:20px;">ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹: <input type="date" id="week-date"></label>
</div>

<label for="room-select">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹:</label>
<select id="room-select">
<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø© --</option>
</select>

<div id="room-warning" style="display:none;color:#b52b2b;background:#ffeaea;padding:10px 20px;margin:10px 0 0 0;border-radius:7px;font-weight:bold;text-align:center;"></div>

<!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ù…ØªÙ‚Ø¯Ù… -->
<div id="booking-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3 id="booking-modal-title" style="color: #1b3767; margin: 0;">ğŸ“ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯</h3>
      <button onclick="closeBookingModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">Ã—</button>
    </div>
    
    <form id="booking-form" onsubmit="submitBooking(event)">
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">ğŸ‘¨â€ğŸ« Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø§Ù„Ù…Ø¹Ù„Ù…Ø©:</label>
        <input type="text" id="teacher-name" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
        <input type="tel" id="teacher-phone" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;" placeholder="Ù…Ø«Ø§Ù„: 99123456">
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">ğŸ“ Ø§Ù„ØµÙ:</label>
        <select id="grade-select" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;" onchange="updateSections()">
          <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØµÙ --</option>
          <option value="5">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</option>
          <option value="6">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³</option>
          <option value="7">Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ø¹</option>
          <option value="8">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù…Ù†</option>
          <option value="9">Ø§Ù„ØµÙ Ø§Ù„ØªØ§Ø³Ø¹</option>
          <option value="10">Ø§Ù„ØµÙ Ø§Ù„Ø¹Ø§Ø´Ø±</option>
          <option value="11">Ø§Ù„ØµÙ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option>
          <option value="12">Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</option>
        </select>
      </div>
      
      <div id="section-container" style="margin-bottom: 15px; display: none;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">ğŸ“š Ø§Ù„Ø´Ø¹Ø¨Ø©:</label>
        <select id="section-select" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;">
          <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø© --</option>
        </select>
      </div>
      
      <div style="margin-bottom: 15px;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">ğŸ“– Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
        <select id="subject-type" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;" onchange="updateSubjectOptions()">
          <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© --</option>
          <option value="regular">Ù…Ø§Ø¯Ø© Ø£Ø³Ø§Ø³ÙŠØ©</option>
          <option value="elective">Ù…Ø§Ø¯Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (Ù„Ù„ØµÙ 11 Ùˆ 12 ÙÙ‚Ø·)</option>
        </select>
      </div>
      
      <div id="regular-subject-container" style="margin-bottom: 15px; display: none;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">ğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©:</label>
        <select id="regular-subject" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;">
          <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø© --</option>
          <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
          <option value="Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©">Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
          <option value="Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
          <option value="Ø§Ù„Ø¹Ù„ÙˆÙ…">Ø§Ù„Ø¹Ù„ÙˆÙ…</option>
          <option value="Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©">Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©</option>
          <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</option>
          <option value="ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
          <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©</option>
          <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ©</option>
          <option value="Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠØ©">Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠØ©</option>
        </select>
      </div>
      
      <div id="elective-subject-container" style="margin-bottom: 15px; display: none;">
        <label style="display: block; margin-bottom: 5px; font-weight: bold; color: #1b3767;">âœï¸ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©:</label>
        <input type="text" id="elective-subject" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 16px;" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©">
      </div>
      
      <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
        <button type="submit" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold;">
          âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²
        </button>
        <button type="button" onclick="closeBookingModal()" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px;">
          âŒ Ø¥Ù„ØºØ§Ø¡
        </button>
      </div>
    </form>
  </div>
</div>

<table id="reservation-table" style="display:none; margin-top:20px;">
<thead>
<tr>
<th>Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø©</th>
<th>Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©</th>
<th>Ø§Ù„Ù†Ø´Ø§Ø·</th>
<th>Ø§Ù„Ø·Ø§Ø¨ÙˆØ±</th>
</tr>
</thead>
<tbody>
<tr><td class="day-cell" data-date="0">Ø§Ù„Ø£Ø­Ø¯ <span class="date-span"></span></td><td data-time="sun-1"></td><td data-time="sun-2"></td><td data-time="sun-3"></td><td data-time="sun-4"></td><td data-time="sun-5"></td><td data-time="sun-6"></td><td data-time="sun-7"></td><td data-time="sun-activity"></td><td data-time="sun-assembly"></td></tr>
<tr><td class="day-cell" data-date="1">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† <span class="date-span"></span></td><td data-time="mon-1"></td><td data-time="mon-2"></td><td data-time="mon-3"></td><td data-time="mon-4"></td><td data-time="mon-5"></td><td data-time="mon-6"></td><td data-time="mon-7"></td><td data-time="mon-activity"></td><td data-time="mon-assembly"></td></tr>
<tr><td class="day-cell" data-date="2">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ <span class="date-span"></span></td><td data-time="tue-1"></td><td data-time="tue-2"></td><td data-time="tue-3"></td><td data-time="tue-4"></td><td data-time="tue-5"></td><td data-time="tue-6"></td><td data-time="tue-7"></td><td data-time="tue-activity"></td><td data-time="tue-assembly"></td></tr>
<tr><td class="day-cell" data-date="3">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡ <span class="date-span"></span></td><td data-time="wed-1"></td><td data-time="wed-2"></td><td data-time="wed-3"></td><td data-time="wed-4"></td><td data-time="wed-5"></td><td data-time="wed-6"></td><td data-time="wed-7"></td><td data-time="wed-activity"></td><td data-time="wed-assembly"></td></tr>
<tr><td class="day-cell" data-date="4">Ø§Ù„Ø®Ù…ÙŠØ³ <span class="date-span"></span></td><td data-time="thu-1"></td><td data-time="thu-2"></td><td data-time="thu-3"></td><td data-time="thu-4"></td><td data-time="thu-5"></td><td data-time="thu-6"></td><td data-time="thu-7"></td><td data-time="thu-activity"></td><td data-time="thu-assembly"></td></tr>
</tbody>
</table>

<button id="export-btn" class="export-btn">â¬‡ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
</main>

<script src="script.js"></script>
<script>
// Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
let currentWeek = 0;
let selectedRoom = null;
let reservations = [];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† localStorage
function loadData() {
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
  const savedRooms = localStorage.getItem('school_rooms');
  const rooms = savedRooms ? JSON.parse(savedRooms) : ['Ø§Ù„Ù…Ø®ØªØ¨Ø±', 'Ù‚Ø§Ø¹Ø© Ø§Ù„Ø­Ø§Ø³ÙˆØ¨', 'Ø§Ù„Ù…ÙƒØªØ¨Ø©', 'Ø§Ù„Ù‚Ø§Ø¹Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'];
  
  // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ø§Ø¹Ø§Øª
  const roomSelect = document.getElementById('room-select');
  roomSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø¹Ø© --</option>';
  rooms.forEach(room => {
    const option = document.createElement('option');
    option.value = room;
    option.textContent = room;
    roomSelect.appendChild(option);
  });
  
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
  const savedReservations = localStorage.getItem('school_reservations');
  reservations = savedReservations ? JSON.parse(savedReservations) : [];
}

// Ø­ÙØ¸ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
function saveReservations() {
  localStorage.setItem('school_reservations', JSON.stringify(reservations));
}

// Ø­Ø³Ø§Ø¨ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (ÙŠØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø£Ø­Ø¯ - Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ)
function getWeekDates(weekOffset = 0) {
  const today = new Date();
  const currentDay = today.getDay(); // 0 = Ø£Ø­Ø¯, 1 = Ø¥Ø«Ù†ÙŠÙ†, 2 = Ø«Ù„Ø§Ø«Ø§Ø¡, Ø¥Ù„Ø®
  const sunday = new Date(today);
  // Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® ÙŠÙˆÙ… Ø§Ù„Ø£Ø­Ø¯ Ù…Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
  sunday.setDate(today.getDate() - currentDay + (weekOffset * 7));
  
  const dates = [];
  for (let i = 0; i < 5; i++) { // Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³ (5 Ø£ÙŠØ§Ù… Ø¯Ø±Ø§Ø³ÙŠØ©)
    const date = new Date(sunday);
    date.setDate(sunday.getDate() + i);
    dates.push(date);
  }
  return dates;
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
function updateWeekDisplay() {
  const dates = getWeekDates(currentWeek);
  const weekRangeSpan = document.getElementById('week-range');
  
  // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
  const startDate = dates[0].toLocaleDateString('en-GB').split('/').reverse().join('/');
  const endDate = dates[4].toLocaleDateString('en-GB').split('/').reverse().join('/');
  weekRangeSpan.textContent = `${startDate} - ${endDate}`;
  
  // ØªØ­Ø¯ÙŠØ« ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  const daySpans = document.querySelectorAll('.date-span');
  daySpans.forEach((span, index) => {
    if (dates[index]) {
      const day = dates[index].getDate();
      const month = dates[index].getMonth() + 1;
      span.textContent = `${day}/${month}`;
    }
  });
  
  // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®
  document.getElementById('week-date').value = dates[0].toISOString().split('T')[0];
}

// Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª
function showReservationTable() {
  if (!selectedRoom) return;
  
  document.getElementById('room-warning').style.display = 'none';
  document.getElementById('reservation-table').style.display = 'table';
  
  // Ù…Ø³Ø­ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
  const cells = document.querySelectorAll('td[data-time]');
  cells.forEach(cell => {
    cell.innerHTML = '';
    cell.style.backgroundColor = '';
    cell.style.cursor = 'pointer';
    cell.onclick = () => bookSlot(cell);
  });
  
  // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  const weekDates = getWeekDates(currentWeek);
  
  // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©
  const reservationsByTimeSlot = {};
  
  reservations.forEach(reservation => {
    if (reservation.room === selectedRoom) {
      const reservationDate = new Date(reservation.date);
      const dayIndex = weekDates.findIndex(date => 
        date.toDateString() === reservationDate.toDateString()
      );
      
      if (dayIndex !== -1) {
        const key = reservation.timeSlot;
        if (!reservationsByTimeSlot[key]) {
          reservationsByTimeSlot[key] = [];
        }
        reservationsByTimeSlot[key].push(reservation);
      }
    }
  });
  
  // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
  Object.keys(reservationsByTimeSlot).forEach(timeSlot => {
    const cell = document.querySelector(`td[data-time="${timeSlot}"]`);
    if (cell) {
      const reservationsInSlot = reservationsByTimeSlot[timeSlot];
      
      if (selectedRoom === 'ØºØ±ÙØ© ØµÙÙŠØ©' && reservationsInSlot.length > 1) {
        // Ø¹Ø±Ø¶ Ø­Ø¬ÙˆØ²Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©
        let cellContent = '<div style="font-size: 0.8em; line-height: 1.2;">';
        
        reservationsInSlot.forEach((reservation, index) => {
          const gradeText = reservation.grade ? `${reservation.grade}` : '';
          const sectionText = reservation.section ? `${reservation.section}` : '';
          const bgColor = index % 2 === 0 ? '#e3f2fd' : '#f1f8e9';
          
          cellContent += `
            <div style="background: ${bgColor}; padding: 4px; border-radius: 3px; margin-bottom: 2px; border: 1px solid #ddd;">
              <div style="font-weight: bold; color: #1565c0; font-size: 0.9em;">ğŸ‘¨â€ğŸ« ${reservation.teacher}</div>
              <div style="color: #1976d2; font-size: 0.85em;">ğŸ“š ${reservation.subject}</div>
              ${gradeText && sectionText ? `<div style="color: #424242; font-size: 0.8em;">ğŸ“ ${gradeText}-${sectionText}</div>` : ''}
              <button onclick="showReservationOptions('${reservation.id}', '${reservation.phone || ''}')" 
                      style="background: #ff9800; color: white; border: none; padding: 2px 6px; border-radius: 3px; font-size: 0.7em; cursor: pointer; width: 100%; margin-top: 1px;">
                âš™ï¸ Ø¥Ø¯Ø§Ø±Ø©
              </button>
            </div>
          `;
        });
        
        cellContent += '</div>';
        
        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± "Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯" Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©
        if (selectedRoom === 'ØºØ±ÙØ© ØµÙÙŠØ©') {
          cellContent += `
            <div style="text-align: center; margin-top: 8px;">
              <button onclick="bookNewSlotInClassroom('${timeSlot}')" 
                      style="background: #4caf50; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8em; cursor: pointer; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                â• Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯
              </button>
            </div>
          `;
        }
        
        cellContent += '</div>';
        cell.innerHTML = cellContent;
        cell.style.backgroundColor = '#fff3e0';
        cell.onclick = null;
      } else {
        // Ø¹Ø±Ø¶ Ø­Ø¬Ø² ÙˆØ§Ø­Ø¯ (Ù„Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© Ø£Ùˆ Ø­Ø¬Ø² ÙˆØ§Ø­Ø¯ ÙÙŠ Ø§Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©)
        const reservation = reservationsInSlot[0];
        const gradeText = reservation.grade ? `Ø§Ù„ØµÙ ${reservation.grade}` : '';
        const sectionText = reservation.section ? `Ø§Ù„Ø´Ø¹Ø¨Ø© ${reservation.section}` : '';
        const phoneText = reservation.phone ? `ğŸ“± ${reservation.phone}` : '';
        
        let cellContent = `
          <div style="background: #e3f2fd; padding: 8px; border-radius: 4px; font-size: 0.85em; line-height: 1.3;">
            <div style="font-weight: bold; color: #1565c0; margin-bottom: 2px;">ğŸ‘¨â€ğŸ« ${reservation.teacher}</div>
            <div style="color: #1976d2; margin-bottom: 2px;">ğŸ“š ${reservation.subject}</div>
            ${gradeText && sectionText ? `<div style="color: #424242; font-size: 0.8em; margin-bottom: 2px;">ğŸ“ ${gradeText} - ${sectionText}</div>` : ''}
            ${phoneText ? `<div style="color: #424242; font-size: 0.8em; margin-bottom: 3px;">${phoneText}</div>` : ''}
            <button onclick="showReservationOptions('${reservation.id}', '${reservation.phone || ''}')" 
                    style="background: #ff9800; color: white; border: none; padding: 3px 8px; border-radius: 3px; font-size: 0.75em; margin-top: 2px; cursor: pointer; width: 100%;">
              âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬Ø²
            </button>
          </div>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø²Ø± "Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯" Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ© Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø­Ø¬Ø² ÙˆØ§Ø­Ø¯
        if (selectedRoom === 'ØºØ±ÙØ© ØµÙÙŠØ©') {
          cellContent += `
            <div style="text-align: center; margin-top: 6px;">
              <button onclick="bookNewSlotInClassroom('${reservation.timeSlot}')" 
                      style="background: #4caf50; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 0.75em; cursor: pointer; font-weight: bold; width: 100%;">
                â• Ø­Ø¬Ø² Ø¥Ø¶Ø§ÙÙŠ
              </button>
            </div>
          `;
        }
        
        cell.innerHTML = cellContent;
        cell.style.backgroundColor = '#f3e5f5';
        cell.onclick = null;
      }
    }
  });
}

// Ø­Ø¬Ø² ÙØªØ±Ø© Ø²Ù…Ù†ÙŠØ©
function bookSlot(cell) {
  // Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©ØŒ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø­Ø¬Ø² Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ù…Ø´ØºÙˆÙ„Ø©
  if (selectedRoom === 'ØºØ±ÙØ© ØµÙÙŠØ©') {
    openBookingModal(cell);
    return;
  }
  
  // Ù„Ù„Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ØŒ Ù…Ù†Ø¹ Ø§Ù„Ø­Ø¬Ø² Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø´ØºÙˆÙ„Ø©
  if (cell.innerHTML.trim()) {
    alert('âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø© Ù…Ø­Ø¬ÙˆØ²Ø© Ø¨Ø§Ù„ÙØ¹Ù„');
    return;
  }
  
  openBookingModal(cell);
}

// Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©
function bookNewSlotInClassroom(timeSlot) {
  if (selectedRoom !== 'ØºØ±ÙØ© ØµÙÙŠØ©') {
    alert('âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©');
    return;
  }
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø®Ø§Ù†Ø© ÙˆÙ‡Ù…ÙŠØ© Ù„Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
  const dummyCell = document.createElement('td');
  dummyCell.setAttribute('data-time', timeSlot);
  dummyCell.setAttribute('data-day', getCurrentDayFromTimeSlot(timeSlot));
  
  currentBookingCell = dummyCell;
  openBookingModal(dummyCell);
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©
function getCurrentDayFromTimeSlot(timeSlot) {
  // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø­Ø¬Ø² ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØªØ±Ø© Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„ÙŠÙˆÙ…
  const existingReservation = reservations.find(r => 
    r.room === selectedRoom && r.timeSlot === timeSlot
  );
  
  if (existingReservation) {
    const date = new Date(existingReservation.date);
    const weekDates = getWeekDates(currentWeek);
    const dayIndex = weekDates.findIndex(weekDate => 
      weekDate.toDateString() === date.toDateString()
    );
    return dayIndex;
  }
  
  // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø­Ø¬Ø² Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø­Ø§Ù„ÙŠ
  return new Date().getDay();
}

// Ø¥Ù„ØºØ§Ø¡ Ø­Ø¬Ø²
function cancelReservation(reservationId) {
  if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ')) {
    reservations = reservations.filter(r => r.id !== reservationId);
    saveReservations();
    showReservationTable();
    alert('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
  }
}

// ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function exportData() {
  if (!selectedRoom) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹');
    return;
  }
  
  const roomReservations = reservations.filter(r => r.room === selectedRoom);
  const csvContent = "data:text/csv;charset=utf-8," + 
    "Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ÙŠÙˆÙ…,Ø§Ù„ÙØªØ±Ø©,Ø§Ù„Ù…Ø¹Ù„Ù…,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„ØµÙ,Ø§Ù„Ø´Ø¹Ø¨Ø©,Ø§Ù„Ù…Ø§Ø¯Ø©,Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©\n" +
    roomReservations.map(r => {
      const date = new Date(r.date);
      const dayName = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³'][date.getDay()];
      const grade = r.grade ? `Ø§Ù„ØµÙ ${r.grade}` : '';
      const section = r.section ? `Ø§Ù„Ø´Ø¹Ø¨Ø© ${r.section}` : '';
      const subjectType = r.subjectType === 'elective' ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©' : 'Ø£Ø³Ø§Ø³ÙŠØ©';
      // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
      const gregorianDate = `${date.getDate()}/${date.getMonth() + 1}/${date.getFullYear()}`;
      return `${gregorianDate},${dayName},${r.timeSlot},${r.teacher},${r.phone || ''},${grade},${section},${r.subject},${subjectType}`;
    }).join("\n");
  
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  const today = new Date();
  const todayFormatted = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
  link.setAttribute("download", `Ø­Ø¬ÙˆØ²Ø§Øª_${selectedRoom}_${todayFormatted}.csv`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
let currentBookingCell = null;

function openBookingModal(cell) {
  currentBookingCell = cell;
  const modal = document.getElementById('booking-modal');
  const title = document.getElementById('booking-modal-title');
  
  // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØªØ±Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
  const timeSlot = cell.getAttribute('data-time');
  const timeText = getTimeSlotText(timeSlot);
  const dayText = getDayText(timeSlot);
  
  title.textContent = `ğŸ“ Ø­Ø¬Ø² ${selectedRoom} - ${dayText} ${timeText}`;
  modal.style.display = 'block';
  
  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  document.getElementById('booking-form').reset();
  document.getElementById('section-container').style.display = 'none';
  document.getElementById('regular-subject-container').style.display = 'none';
  document.getElementById('elective-subject-container').style.display = 'none';
}

function closeBookingModal() {
  document.getElementById('booking-modal').style.display = 'none';
  currentBookingCell = null;
}

function updateSections() {
  const gradeSelect = document.getElementById('grade-select');
  const sectionContainer = document.getElementById('section-container');
  const sectionSelect = document.getElementById('section-select');
  const subjectType = document.getElementById('subject-type');
  
  const grade = gradeSelect.value;
  
  if (grade) {
    sectionContainer.style.display = 'block';
    sectionSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø© --</option>';
    
    let sectionCount;
    if (grade >= 5 && grade <= 10) {
      sectionCount = 3; // 3 Ø´Ø¹Ø¨ Ù„Ù„ØµÙÙˆÙ 5-10
    } else if (grade >= 11 && grade <= 12) {
      sectionCount = 6; // 6 Ø´Ø¹Ø¨ Ù„Ù„ØµÙÙˆÙ 11-12
    }
    
    for (let i = 1; i <= sectionCount; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `Ø§Ù„Ø´Ø¹Ø¨Ø© ${i}`;
      sectionSelect.appendChild(option);
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø®ÙŠØ§Ø±Ø§Øª Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©
    subjectType.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø© --</option>';
    subjectType.innerHTML += '<option value="regular">Ù…Ø§Ø¯Ø© Ø£Ø³Ø§Ø³ÙŠØ©</option>';
    
    if (grade >= 11 && grade <= 12) {
      subjectType.innerHTML += '<option value="elective">Ù…Ø§Ø¯Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©</option>';
    }
  } else {
    sectionContainer.style.display = 'none';
  }
}

function updateSubjectOptions() {
  const subjectType = document.getElementById('subject-type').value;
  const regularContainer = document.getElementById('regular-subject-container');
  const electiveContainer = document.getElementById('elective-subject-container');
  
  // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ø§ Ø§Ù„Ø­Ø§ÙˆÙŠØªÙŠÙ†
  regularContainer.style.display = 'none';
  electiveContainer.style.display = 'none';
  
  if (subjectType === 'regular') {
    regularContainer.style.display = 'block';
  } else if (subjectType === 'elective') {
    electiveContainer.style.display = 'block';
  }
}

function submitBooking(event) {
  event.preventDefault();
  
  if (!currentBookingCell) return;
  
  // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
  const teacherName = document.getElementById('teacher-name').value.trim();
  const teacherPhone = document.getElementById('teacher-phone').value.trim();
  const grade = document.getElementById('grade-select').value;
  const section = document.getElementById('section-select').value;
  const subjectType = document.getElementById('subject-type').value;
  
  let subject;
  if (subjectType === 'regular') {
    subject = document.getElementById('regular-subject').value;
  } else if (subjectType === 'elective') {
    subject = document.getElementById('elective-subject').value.trim();
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  if (!teacherName || !teacherPhone || !grade || !section || !subject) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
    return;
  }
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
  const phoneRegex = /^[0-9]{8}$/;
  if (!phoneRegex.test(teacherPhone)) {
    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ù‡Ø§ØªÙ ØµØ­ÙŠØ­ (8 Ø£Ø±Ù‚Ø§Ù…)');
    return;
  }
  
  const timeSlot = currentBookingCell.getAttribute('data-time');
  const weekDates = getWeekDates(currentWeek);
  
  // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…
  let dayIndex;
  if (timeSlot.startsWith('sun')) dayIndex = 0;
  else if (timeSlot.startsWith('mon')) dayIndex = 1;
  else if (timeSlot.startsWith('tue')) dayIndex = 2;
  else if (timeSlot.startsWith('wed')) dayIndex = 3;
  else if (timeSlot.startsWith('thu')) dayIndex = 4;

  // ÙØ­Øµ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ù‚Ø¨Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¬Ø²
  const targetDate = weekDates[dayIndex].toISOString();
  const existingReservations = reservations.filter(r => 
    r.room === selectedRoom && 
    r.timeSlot === timeSlot && 
    r.date === targetDate
  );

  // Ù…Ù†Ø·Ù‚ Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø©
  if (selectedRoom === 'ØºØ±ÙØ© ØµÙÙŠØ©') {
    // Ù„Ù„ØºØ±ÙØ© Ø§Ù„ØµÙÙŠØ©: ÙŠÙÙ…Ù†Ø¹ Ø§Ù„ØªØ¹Ø§Ø±Ø¶ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙØ³ Ø§Ù„ØµÙ ÙˆÙ†ÙØ³ Ø§Ù„Ø´Ø¹Ø¨Ø©
    const conflictingReservation = existingReservations.find(r => 
      r.grade === grade && r.section === section
    );
    
    if (conflictingReservation) {
      alert(`âš ï¸ ØªØ¹Ø§Ø±Ø¶ ÙÙŠ Ø§Ù„Ø­Ø¬Ø²!\nÙŠÙˆØ¬Ø¯ Ø­Ø¬Ø² Ø³Ø§Ø¨Ù‚ Ù„Ù†ÙØ³ Ø§Ù„ØµÙ (${grade}) ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© (${section}) ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª.\n\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${conflictingReservation.teacher}\nğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${conflictingReservation.subject}\nğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${conflictingReservation.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`);
      return;
    }
  } else {
    // Ù„Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚Ø§Ø¹Ø§Øª: ÙŠÙÙ…Ù†Ø¹ Ø£ÙŠ Ø­Ø¬Ø² Ø¥Ø¶Ø§ÙÙŠ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª
    if (existingReservations.length > 0) {
      const existingReservation = existingReservations[0];
      alert(`âš ï¸ Ø§Ù„Ù‚Ø§Ø¹Ø© Ù…Ø­Ø¬ÙˆØ²Ø©!\nÙŠÙˆØ¬Ø¯ Ø­Ø¬Ø² Ø³Ø§Ø¨Ù‚ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª.\n\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${existingReservation.teacher}\nğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${existingReservation.subject}\nğŸ“ Ø§Ù„ØµÙ: ${existingReservation.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${existingReservation.section}\nğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${existingReservation.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}`);
      return;
    }
  }
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯
  const reservation = {
    id: Date.now().toString(),
    room: selectedRoom,
    teacher: teacherName,
    phone: teacherPhone,
    grade: grade,
    section: section,
    subject: subject,
    subjectType: subjectType,
    timeSlot: timeSlot,
    date: weekDates[dayIndex].toISOString(),
    createdAt: new Date().toISOString()
  };
  
  reservations.push(reservation);
  saveReservations();
  showReservationTable();
  closeBookingModal();
  
  // Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù…Ø®ØµØµØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¹Ø©
  if (selectedRoom === 'ØºØ±ÙØ© ØµÙÙŠØ©' && existingReservations.length > 0) {
    alert(`âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ø¬Ø² Ø¥Ø¶Ø§ÙÙŠ Ø¨Ù†Ø¬Ø§Ø­!\nğŸ« Ø§Ù„Ù‚Ø§Ø¹Ø©: ${selectedRoom}\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${teacherName}\nğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${teacherPhone}\nğŸ“ Ø§Ù„ØµÙ: ${grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${section}\nğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${subject}\n\nğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙˆØ¬Ø¯ ${existingReservations.length} Ø­Ø¬Ø² Ø¢Ø®Ø± ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª`);
  } else {
    alert(`âœ… ØªÙ… Ø­Ø¬Ø² Ø§Ù„Ù‚Ø§Ø¹Ø© Ø¨Ù†Ø¬Ø§Ø­!\nğŸ« Ø§Ù„Ù‚Ø§Ø¹Ø©: ${selectedRoom}\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${teacherName}\nğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${teacherPhone}\nğŸ“ Ø§Ù„ØµÙ: ${grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${section}\nğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${subject}`);
  }
}

function getTimeSlotText(timeSlot) {
  const timeMap = {
    '1': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ (7:30 - 8:15)',
    '2': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (8:15 - 9:00)',
    '3': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø© (9:00 - 9:45)',
    '4': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© (10:15 - 11:00)',
    '5': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø®Ø§Ù…Ø³Ø© (11:00 - 11:45)',
    '6': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø³Ø§Ø¯Ø³Ø© (11:45 - 12:30)',
    '7': 'Ø§Ù„Ø­ØµØ© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø© (1:00 - 1:45)'
  };
  
  const period = timeSlot.slice(-1);
  return timeMap[period] || `Ø§Ù„Ø­ØµØ© ${period}`;
}

function getDayText(timeSlot) {
  if (timeSlot.startsWith('sun')) return 'Ø§Ù„Ø£Ø­Ø¯';
  if (timeSlot.startsWith('mon')) return 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†';
  if (timeSlot.startsWith('tue')) return 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡';
  if (timeSlot.startsWith('wed')) return 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡';
  if (timeSlot.startsWith('thu')) return 'Ø§Ù„Ø®Ù…ÙŠØ³';
  return '';
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
function showReservationOptions(reservationId, phoneNumber) {
  const reservation = reservations.find(r => r.id === reservationId);
  if (!reservation) {
    alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¬Ø²');
    return;
  }
  
  let options = `ğŸ”§ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø¬Ø²:\n`;
  options += `ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${reservation.teacher}\n`;
  options += `ğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${reservation.subject}\n`;
  if (reservation.grade && reservation.section) {
    options += `ğŸ“ Ø§Ù„ØµÙ: ${reservation.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${reservation.section}\n`;
  }
  if (reservation.phone) {
    options += `ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${reservation.phone}\n`;
  }
  options += `\nØ§Ø®ØªØ± Ø¥Ø¬Ø±Ø§Ø¡Ù‹:\n`;
  options += `1ï¸âƒ£ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø²\n`;
  options += `2ï¸âƒ£ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²\n`;
  options += `3ï¸âƒ£ Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„\n`;
  options += `âŒ Ø¥ØºÙ„Ø§Ù‚`;
  
  const choice = prompt(options + '\n\nØ£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø®ÙŠØ§Ø± (1-3):');
  
  if (choice === '1') {
    cancelReservationWithPhone(reservationId, phoneNumber);
  } else if (choice === '2') {
    editReservation(reservationId, phoneNumber);
  } else if (choice === '3') {
    showReservationDetails(reservation);
  }
}

function cancelReservationWithPhone(reservationId, phoneNumber) {
  const reservation = reservations.find(r => r.id === reservationId);
  
  if (phoneNumber && reservation.phone) {
    const enteredPhone = prompt(`ğŸ” Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„:\n(Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${reservation.phone})`);
    
    if (enteredPhone !== reservation.phone) {
      alert('âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø².');
      return;
    }
  }
  
  if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¬Ø²ØŸ\n\nğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${reservation.teacher}\nğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${reservation.subject}`)) {
    reservations = reservations.filter(r => r.id !== reservationId);
    saveReservations();
    showReservationTable();
    alert('âœ… ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² Ø¨Ù†Ø¬Ø§Ø­');
  }
}

function editReservation(reservationId, phoneNumber) {
  const reservation = reservations.find(r => r.id === reservationId);
  
  if (phoneNumber && reservation.phone) {
    const enteredPhone = prompt(`ğŸ” Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø³Ø¬Ù„:\n(Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${reservation.phone})`);
    
    if (enteredPhone !== reservation.phone) {
      alert('âŒ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­. Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø¬Ø².');
      return;
    }
  }
  
  alert('ğŸ”„ Ù…ÙŠØ²Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø³ØªØªÙˆÙØ± Ù‚Ø±ÙŠØ¨Ø§Ù‹. ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¬Ø² ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø­Ø¬Ø² Ø¬Ø¯ÙŠØ¯.');
}

function showReservationDetails(reservation) {
  let details = `ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø²:\n\n`;
  details += `ğŸ¢ Ø§Ù„Ù‚Ø§Ø¹Ø©: ${reservation.room}\n`;
  details += `ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…: ${reservation.teacher}\n`;
  details += `ğŸ“š Ø§Ù„Ù…Ø§Ø¯Ø©: ${reservation.subject}\n`;
  
  if (reservation.grade && reservation.section) {
    details += `ğŸ“ Ø§Ù„ØµÙ: ${reservation.grade} - Ø§Ù„Ø´Ø¹Ø¨Ø© ${reservation.section}\n`;
  }
  
  if (reservation.phone) {
    details += `ğŸ“± Ø§Ù„Ù‡Ø§ØªÙ: ${reservation.phone}\n`;
  }
  
  if (reservation.subjectType) {
    const typeText = reservation.subjectType === 'elective' ? 'Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©' : 'Ø£Ø³Ø§Ø³ÙŠØ©';
    details += `ğŸ“– Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø¯Ø©: ${typeText}\n`;
  }
  
  const createdDate = new Date(reservation.createdAt);
  const createdFormatted = `${createdDate.getDate()}/${createdDate.getMonth() + 1}/${createdDate.getFullYear()} ${createdDate.getHours()}:${createdDate.getMinutes().toString().padStart(2, '0')}`;
  details += `ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¬Ø²: ${createdFormatted}\n`;
  
  const sessionDate = new Date(reservation.date);
  const sessionFormatted = `${sessionDate.getDate()}/${sessionDate.getMonth() + 1}/${sessionDate.getFullYear()}`;
  details += `ğŸ—“ï¸ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¬Ù„Ø³Ø©: ${sessionFormatted}`;
  
  alert(details);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
document.addEventListener('DOMContentLoaded', function() {
  loadData();
  updateWeekDisplay();
  
  // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
  document.getElementById('prev-week').onclick = () => {
    currentWeek--;
    updateWeekDisplay();
    if (selectedRoom) showReservationTable();
  };
  
  document.getElementById('next-week').onclick = () => {
    currentWeek++;
    updateWeekDisplay();
    if (selectedRoom) showReservationTable();
  };
  
  // ØªØºÙŠÙŠØ± Ø§Ù„Ù‚Ø§Ø¹Ø©
  document.getElementById('room-select').onchange = function() {
    selectedRoom = this.value;
    if (selectedRoom) {
      showReservationTable();
    } else {
      document.getElementById('reservation-table').style.display = 'none';
      document.getElementById('room-warning').style.display = 'block';
      document.getElementById('room-warning').textContent = 'âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø¹Ø© Ù„Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª';
    }
  };
  
  // ØªØºÙŠÙŠØ± ØªØ§Ø±ÙŠØ® Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹
  document.getElementById('week-date').onchange = function() {
    const selectedDate = new Date(this.value);
    const today = new Date();
    const diffTime = selectedDate.getTime() - today.getTime();
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    currentWeek = Math.floor(diffDays / 7);
    updateWeekDisplay();
    if (selectedRoom) showReservationTable();
  };
  
  // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  document.getElementById('export-btn').onclick = exportData;
});

// Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØªØ«Ø¨ÙŠØª Ù…ÙˆÙ‚Ø¹Ù‡ ÙÙŠ Ø£Ø¹Ù„Ù‰ ÙŠØ³Ø§Ø± Ø§Ù„ØµÙØ­Ø©
function toggleMenuButton() {
	var btn = document.getElementById('menu-toggle');
	var nav = document.getElementById('nav-links');
	btn.style.position = 'fixed';
	btn.style.left = '18px';
	btn.style.top = '18px';
	btn.style.zIndex = '1100';
	if(window.innerWidth <= 768) {
		btn.style.display = 'block';
		nav.style.position = 'absolute';
		nav.style.top = '60px';
		nav.style.left = '50%';
		nav.style.transform = 'translateX(-50%)';
		nav.style.width = '90vw';
		nav.style.maxWidth = '320px';
		nav.style.background = '#fff';
		nav.style.boxShadow = '0 2px 12px #1b376722';
		nav.style.borderRadius = '12px';
		nav.style.zIndex = '1000';
	} else {
		btn.style.display = 'none';
		nav.style.position = '';
		nav.style.top = '';
		nav.style.left = '';
		nav.style.transform = '';
		nav.style.width = '';
		nav.style.maxWidth = '';
		nav.style.background = 'rgba(27,55,103,0.12)';
		nav.style.boxShadow = '0 2px 12px rgba(27,55,103,0.08)';
		nav.style.borderRadius = '16px';
		nav.style.zIndex = '';
		nav.classList.remove('show');
	}
}
window.addEventListener('resize', toggleMenuButton);
window.addEventListener('DOMContentLoaded', toggleMenuButton);
</script>
</body>
<footer style="background:rgba(27,55,103,0.08); color:#1b3767; text-align:center; padding:18px 0; font-size:1.1em; font-family:'Times New Roman', Times, serif; margin-top:40px; border-radius:0 0 16px 16px;">
	Ù…ØµÙ…Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ : ÙˆÙØ§Ø¡ Ø§Ù„Ø´Ø¹ÙŠÙ„ÙŠØ© &mdash; Ù…Ø¹Ù„Ù…Ø© ØªÙ‚Ù†ÙŠØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
</footer>
</html>
